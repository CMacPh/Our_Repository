pengle_setup = {
	set_variable = {
		var = current_sacrifices
		value = 0
	}
	set_variable = {
		var = overall_sacrifices
		value = 0
	}
}

pengle_decrease_sacrifices_10k = {
	add_to_variable = {
		var = current_sacrifices
		value = -1
	}
}

convert_pops_pengle = {
	if = {
		limit = { has_war = no }
		every_owned_state = {
			limit = {
				NOT = { is_core_of = ROOT }
			}
			decrease_population_pengle = yes
		}
	}
	else = {
		every_state = {
			limit = {
				NOT = { is_core_of = ROOT }
				OR = {
					is_owned_by = ROOT
					is_controlled_by = ROOT
				}
			}
			decrease_population_pengle = yes
		}
	}
}

#TODO: Figure out if i butchered something here
decrease_population_pengle = {

	#set_temp_variable = { pop_to_kill = -10000 }
	
	#if = {
	#	limit = { check_variable = { pop_to_kill < 0 } }
	#	multiply_temp_variable = { pop_to_kill = -1 }
	#}
	
	#multiply_temp_variable = { pop_to_kill = 0.1 } #10%
	#round_variable = pop_to_kill
	
	ROOT = { 
		add_to_variable = {
			var = current_sacrifices
			value = 1
		}
		add_to_variable = {
			var = overall_sacrifices
			value = 1
		} 
	}
	
	#multiply_temp_variable = { pop_to_kill = -1 }
	#add_manpower = pop_to_kill
}

roll_alicorn_chance = {

	if = {
		limit = {
			STL = {
				owns_state = 3
				owns_state = 53
			}
		}
		
		set_variable = {
			var = alicorn_chance
			value = 40
		}
	}
	else = {
		set_variable = {
			var = alicorn_chance
			value = 20
		}
	}
	
	if = {
		check_variable = { 
			overall_sacrifices < 4  
		}
		add_to_variable = {
			var = alicorn_chance
			value = 50
		}
		else = {
			if = {
				check_variable = { 
					overall_sacrifices < 3  
				}
				add_to_variable = {
					var = alicorn_chance
					value = 40
				}
				else = {
					if = {
						check_variable = { 
							overall_sacrifices < 2  
						}
						add_to_variable = {
							var = alicorn_chance
							value = 30
						}
						else = {
							if = {
								check_variable = { 
									overall_sacrifices < 1  
								}
								add_to_variable = {
									var = alicorn_chance
									value = 20
								}
								else = {
									if = {
										check_variable = { 
											overall_sacrifices < 0  
										}
										add_to_variable = {
											var = alicorn_chance
											value = 10
										}
										else = {
										
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	set_variable = {
		var = fail_chance
		value = 100
	}
	
	subtract_from_variable = {
		var = fail_chance
		value = alicorn_chance
	}
	
	random_list = {
	
		alicorn_chance = {
			country_event = Our_Country_Alicorn.2
		}
		fail_chance = {
			country_event = Our_Country_Alicorn.3
		}
	}
}
